<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Branch WebSDK Test</title>
</head>
<body>

  <!-- Textarea to show SDK load/init status -->
  <textarea id="branchOutput"
            style="width:100%; height:120px; font-family:monospace;"
            readonly
            placeholder="Branch status will appear here…"></textarea>

  <p>
    <a href="https://timber.app.link/RsE3xtpXITb">Test SwiftUI App</a> |
    <a href="web+uwptestapp://" id="appLink">Open My App</a> |
    <a href="example.html">Load Example Page</a>
  </p>

  <button onclick="register()">Register Protocol Handler</button>

  <script>
    function register() {
      navigator.registerProtocolHandler(
        "web+uwptestapp",
        "https://nidhidixit09.github.io/loadApp.html?uri=%s",
        "UWPTestApp"
      );
    }
  </script>

  <!-- Branch Web SDK loader with onerror handler -->
  <script>
    (function(b,r,a,n,c,h,_,s,d,k){
      if (!b[n] || !b[n]._q) {
        for (; s < _.length; ) c(h, _[s++]);
        d = r.createElement(a);
        d.async = 1;
        d.src = "https://cdn.branch.io/branch-latest.min.js";

        // If the script fails to load (e.g. blocked), show an error
        d.onerror = function(evt) {
          var out = document.getElementById('branchOutput');
          out.value = '❌ Failed to load Branch SDK script:\n' +
                      (evt && evt.message ? evt.message : '(no message)');
        };

        k = r.getElementsByTagName(a)[0];
        k.parentNode.insertBefore(d, k);
        b[n] = h;
      }
    })(
      window,
      document,
      "script",
      "branch",
      function(b,r){ b[r] = function(){ b._q.push([r, arguments]); }; },
      { _q: [], _v: 1 },
      "addListener banner closeBanner closeJourney data deepview deepviewCta first init link logout removeListener setBranchViewData setIdentity track trackCommerceEvent logEvent disableTracking getBrowserFingerprintId crossPlatformIds lastAttributedTouchData setAPIResponseCallback qrCode setRequestMetaData setAPIUrl getAPIUrl setDMAParamsForEEA".split(" "),
      0
    );
  </script>

  <!-- Initialize Branch and print result or error -->
  <script>
    // Give the SDK a moment to load
    function tryInitBranch() {
      if (!window.branch || !branch.init) {
        // SDK not yet ready—retry shortly
        return setTimeout(tryInitBranch, 50);
      }

      branch.init('key_live_YOUR_KEY_GOES_HERE', function(err, data) {
        var out = document.getElementById('branchOutput');
        if (err) {
          out.value = '❌ Branch init error:\n' + JSON.stringify(err, null, 2);
        } else {
          var text = '✅ Branch init success:\n' + JSON.stringify(data, null, 2);
          if (data && data.data_parsed) {
            text += '\n\nDeep link data:\n' + JSON.stringify(data.data_parsed, null, 2);
          }
          out.value = text;
        }
      });
    }

    // Kick off init after load
    tryInitBranch();
  </script>

</body>
</html>

